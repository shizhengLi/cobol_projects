# 模块构成图

## 概述

保险会计系统由一个主程序和三个子程序组成，形成明确的模块化结构。本文档描述了系统的模块构成及各模块的主要功能。

## 主程序 INSPMUPD_EN 模块构成图

```
1. 全体开始处理 (1000-INIT-PROCESS)
   |
   ├── 1.1. 初始化变量和计数器
   |
   ├── 1.2. 获取当前日期和时间
   |
   ├── 1.3. 设置会计期间
   |
   ├── 1.4. 打开文件
   |
   ├── 1.5. 生成报表头部
   |
   ├── 1.6. 记录开始日志 (调用INSPMLOG_EN子程序)
   |
   └── 1.7. 读取第一条记录 (调用2100-READ-PAYMENT-FILE)
   
2. 数据处理循环 (2000-PROCESS-DATA，循环直到文件结束)
   |
   ├── 2.1. 解析支付记录字段
   |
   ├── 2.2. 验证保单 (调用INSPOLVD子程序)
   |
   ├── 2.3. 保单验证后处理
   |    |
   |    └── 2.3.1. 插入支付记录 (2200-INSERT-PAYMENT，调用INSPMINS子程序)
   |
   ├── 2.4. 格式化输出数据
   |    |
   |    ├── 2.4.1. 日期格式化
   |    |
   |    └── 2.4.2. 支付方式格式化
   |
   ├── 2.5. 生成报表明细行
   |
   └── 2.6. 读取下一条记录 (调用2100-READ-PAYMENT-FILE)
   
3. 全体结束处理 (3000-END-PROCESS)
   |
   ├── 3.1. 生成报表汇总行
   |
   ├── 3.2. 记录结束日志 (调用INSPMLOG_EN子程序)
   |
   └── 3.3. 关闭文件
```

## 子程序模块构成图

### INSPOLVD - 保单验证子程序

```
1. 保单验证处理 (0000-MAIN-PROCESS)
   |
   ├── 1.1. 初始化计数器
   |
   ├── 1.2. 检查保单ID是否存在
   |    |
   |    └── 1.2.1. 模拟数据库查询 (实际环境中为SQL查询)
   |
   └── 1.3. 返回处理结果
```

### INSPMINS - 支付记录插入子程序

```
1. 支付记录插入处理 (0000-MAIN-PROCESS)
   |
   ├── 1.1. 获取当前时间戳
   |
   ├── 1.2. 处理支付记录插入
   |    |
   |    └── 1.2.1. 模拟数据库插入操作 (实际环境中为SQL插入)
   |
   └── 1.3. 返回处理结果
```

### INSPMLOG_EN - 日志记录子程序

```
1. 日志记录处理 (0000-MAIN-PROCESS)
   |
   ├── 1.1. 获取当前时间戳
   |
   ├── 1.2. 检查并打开日志文件
   |
   ├── 1.3. 格式化日志记录
   |
   ├── 1.4. 写入日志记录
   |
   └── 1.5. 返回处理结果
```

## 模块间调用关系

```
+-------------+     调用      +--------------+
|             |------------->|              |
|  INSPMUPD   |              |   INSPOLVD   |
|             |<-------------|              |
+-------------+    返回结果    +--------------+

+-------------+     调用      +--------------+
|             |------------->|              |
|  INSPMUPD   |              |   INSPMINS   |
|             |<-------------|              |
+-------------+    返回结果    +--------------+

+-------------+     调用      +--------------+
|             |------------->|              |
|  INSPMUPD   |              | INSPMLOG_EN  |
|             |<-------------|              |
+-------------+    返回结果    +--------------+
```

## 模块功能说明

### 1. 全体开始处理 (1000-INIT-PROCESS)
初始化批处理程序的环境和参数，为后续处理做准备。包括初始化变量、获取系统日期时间、设置会计期间、打开输入输出文件、生成报表头部和记录开始日志。

### 2. 数据处理循环 (2000-PROCESS-DATA)
处理输入文件中的每一条支付记录。包括解析记录字段、验证保单ID有效性、插入有效支付记录到数据库、格式化输出数据和生成报表明细行。这是批处理程序的核心处理模块。

### 3. 全体结束处理 (3000-END-PROCESS)
完成批处理程序的收尾工作。包括生成处理汇总信息、记录结束日志和关闭所有文件。

### 4. 保单验证处理 (INSPOLVD)
验证支付记录中的保单ID是否存在于保单表中。这是确保数据有效性的关键步骤，避免处理不存在保单的支付记录。

### 5. 支付记录插入处理 (INSPMINS)
将验证通过的支付记录插入到保费支付表中。这是批处理程序的主要数据处理操作，实现保费支付数据的存储。

### 6. 日志记录处理 (INSPMLOG_EN)
记录程序执行过程中的关键事件和信息，支持问题排查和审计。包括记录程序启动、结束和处理统计信息。 
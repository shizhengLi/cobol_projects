# 保险会计系统概要设计书

## 目录

1. [项目基本信息](#项目基本信息)
2. [修订历史](#修订历史)
3. [程序使用物清单](#程序使用物清单)
4. [输入输出项目](#输入输出项目)
5. [处理概要](#处理概要)
6. [模块构成图](#模块构成图)
7. [处理详细-处理对象数据取得](#处理详细-处理对象数据取得)
8. [输入输出定义书](#输入输出定义书)
9. [子程序连接规格](#子程序连接规格)

## 项目基本信息

- **项目代码**: INSACC
- **项目名称**: 保险会计系统
- **成果物ID**: COBOL-INSACC-001
- **子系统**: 保费支付管理
- **创建日期**: 2025-07-15
- **创建人**: DEMO

## 修订历史

| 修订编号 | 日期       | 理由       | 内容               | 备注 | 负责人 | 审批人 |
|----------|------------|------------|------------------|------|--------|--------|
| 001      | 2025-07-15 | 初始版本   | 创建初始设计文档   | 无   | DEMO   | DEMO   |

## 程序使用物清单

### 子程序
1. **INSPOLVD - 保单验证子程序**
   - **I/O**: 输入
   - **说明**: 验证保单ID是否存在于数据库中。
   - **备注**: 无

2. **INSPMINS - 支付记录插入子程序**
   - **I/O**: 输入
   - **说明**: 将支付记录插入到数据库中。
   - **备注**: 无

3. **INSPMLOG - 日志记录子程序**
   - **I/O**: 输入
   - **说明**: 记录程序日志信息。
   - **备注**: 无

### 文件
4. **PAYMENT-FILE - 保费支付更新文件**
   - **I/O**: 输入
   - **说明**: 包含保费支付更新记录。
   - **备注**: 固定长度记录，每条58字节

5. **REPORT-FILE - 处理报告文件**
   - **I/O**: 输出
   - **说明**: 包含处理结果的报告。
   - **备注**: 无

6. **LOG-FILE - 日志文件**
   - **I/O**: 输出
   - **说明**: 记录程序执行日志。
   - **备注**: 无

### 数据库表
7. **CUSTOMER - 客户表**
   - **I/O**: 输入
   - **说明**: 存储客户信息。
   - **备注**: 无

8. **INSURANCE_POLICY - 保单表**
   - **I/O**: 输入
   - **说明**: 存储保单信息。
   - **备注**: 无

9. **PREMIUM_PAYMENT - 保费支付表**
   - **I/O**: 输出
   - **说明**: 存储保费支付记录。
   - **备注**: 无

### 环境变量
10. **PAYFILE - 支付文件路径**
    - **I/O**: 输入
    - **说明**: 指定保费支付更新文件的路径。
    - **备注**: 无

11. **REPFILE - 报告文件路径**
    - **I/O**: 输入
    - **说明**: 指定处理报告文件的路径。
    - **备注**: 无

12. **LOGFILE - 日志文件路径**
    - **I/O**: 输入
    - **说明**: 指定日志文件的路径。
    - **备注**: 无

## 输入输出项目

### 文件区变量

**机能ID**: INSPMUPD

| 项目编号 | 物理名称 | 逻辑名称 | 数据类型 | 初始值 | 必须 | 备注 |
|----------|----------|----------|---------|-------|------|------|
| 1 | PAYMENT-RECORD-IN | 支付记录输入 | X(58) | 无 | 是 | 输入文件记录 |
| 2 | REPORT-LINE | 报告行 | X(132) | 无 | 是 | 输出报告记录 |

### 工作存储区变量

**机能ID**: INSPMUPD

| 项目编号 | 物理名称 | 逻辑名称 | 数据类型 | 初始值 | 必须 | 备注 |
|----------|----------|----------|---------|-------|------|------|
| 3 | WS-FILE-STATUS | 文件状态 | XX | SPACES | 是 | 文件操作状态 |
| 4 | WS-EOF-FLAG | 文件结束标志 | X | 'N' | 是 | 文件读取结束标志 |
| 5 | WS-READ-COUNT | 读取计数 | 9(5) | ZEROS | 是 | 读取记录计数 |
| 6 | WS-PROCESS-COUNT | 处理计数 | 9(5) | ZEROS | 是 | 处理记录计数 |
| 7 | WS-ERROR-COUNT | 错误计数 | 9(5) | ZEROS | 是 | 错误记录计数 |
| 8 | WS-ACCOUNTING-PERIOD | 会计期间 | X(6) | 无 | 是 | 当前会计期间(YYYYMM) |
| 9 | PR-POLICY-ID | 保单ID | X(10) | 无 | 是 | 保单标识符 |
| 10 | PR-PAYMENT-DATE | 支付日期 | X(8) | 无 | 是 | 支付日期(YYYYMMDD) |
| 11 | PR-PAYMENT-METHOD | 支付方式 | X(2) | 无 | 是 | 支付方式代码 |
| 12 | PR-AMOUNT | 支付金额 | 9(8)V99 | 无 | 是 | 保费金额 |
| 13 | PR-PAYMENT-ID | 支付ID | X(12) | 无 | 是 | 支付记录标识符 |
| 14 | PR-REFERENCE-NO | 参考编号 | X(16) | 无 | 否 | 支付参考编号 |

## 处理概要

### 处理概要说明
INSPMUPD程序从保费支付更新文件中读取记录，验证保单是否存在，然后将支付记录插入数据库，并生成处理报告和日志。

### 处理概要图
```
+----------------+     +----------------+     +----------------+     +----------------+
|                |     |                |     |                |     |                |
|  保费支付文件   | --> |  验证保单存在   | --> |  插入支付记录   | --> |  生成处理报告  |
|                |     |                |     |                |     |                |
+----------------+     +----------------+     +----------------+     +----------------+
```

### 实行条件
每天23:00自动运行，处理当天收到的保费支付记录。

### 入出力CRUD

| 表/文件名称 | 创建(C) | 读取(R) | 更新(U) | 删除(D) |
|------------|--------|--------|--------|--------|
| CUSTOMER | | ✓ | | |
| INSURANCE_POLICY | | ✓ | | |
| PREMIUM_PAYMENT | ✓ | | | |
| PAYMENT-FILE | | ✓ | | |
| REPORT-FILE | ✓ | | | |
| LOG-FILE | ✓ | | | |

## 模块构成图

1. **全体开始处理**
   - 1-1 初始化处理
   - 1-2 获取当前日期和时间
   - 1-3 设置会计期间
   - 1-4 打开文件
   - 1-5 写入报表头
   - 1-6 记录开始日志

2. **数据处理**
   - 2-1 读取支付文件
     - 2-1-1 解析支付记录
   - 2-2 验证保单
     - 2-2-1 调用保单验证子程序
   - 2-3 插入支付记录
     - 2-3-1 调用支付记录插入子程序
   - 2-4 格式化报表行
   - 2-5 写入报表明细

3. **全体结束处理**
   - 3-1 写入报表汇总
   - 3-2 记录结束日志
   - 3-3 关闭文件

## 处理详细-处理对象数据取得

**INSPMUPD程序**:

1. **初始化处理**:
   - 初始化计数器和标志
   - 获取当前日期和时间
   - 设置会计期间为当前年月
   - 打开输入和输出文件
   - 写入报表头部
   - 调用日志子程序记录开始信息

2. **处理数据循环**:
   - 解析输入记录中的保单ID、支付日期、支付方式等
   - 调用保单验证子程序检查保单是否存在
   - 如果保单存在，调用支付记录插入子程序
   - 格式化支付日期和支付方式代码
   - 写入处理结果到报表

3. **结束处理**:
   - 汇总处理结果
   - 写入报表汇总行
   - 调用日志子程序记录结束信息
   - 关闭所有文件

## 输入输出定义书

**STEP1: 保费支付记录处理**

| 编号 | 输入表/文件名 | 条件 | 输入项目名 | 编辑内容 | 输出表/文件名 | 输出类型 | 输出条件 | 项目名 | 备注 |
|------|--------------|------|-----------|----------|--------------|---------|----------|-------|------|
| 1 | PAYMENT-FILE | - | PR-POLICY-ID | - | - | - | - | - | 保单ID |
| 2 | PAYMENT-FILE | - | PR-PAYMENT-DATE | 转换为YYYY-MM-DD格式 | REPORT-FILE | WRITE | - | DL-PAYMENT-DATE | 支付日期 |
| 3 | PAYMENT-FILE | - | PR-PAYMENT-METHOD | 根据代码转换为文本描述 | REPORT-FILE | WRITE | - | DL-PAYMENT-METHOD | 支付方式 |
| 4 | PAYMENT-FILE | - | PR-AMOUNT | 格式化为数字 | REPORT-FILE | WRITE | - | DL-AMOUNT | 支付金额 |
| 5 | PAYMENT-FILE | - | PR-PAYMENT-ID | - | REPORT-FILE | WRITE | - | DL-PAYMENT-ID | 支付ID |
| 6 | PAYMENT-FILE | - | PR-REFERENCE-NO | - | REPORT-FILE | WRITE | - | DL-REFERENCE-NO | 参考编号 |
| 7 | - | 保单存在 | - | - | PREMIUM_PAYMENT | INSERT | - | - | 支付记录 |

## 子程序连接规格

### 子程序 INSPOLVD - 保单验证子程序

- **输入参数**:
  - **LS-POLICY-ID**: X型，10位，保单ID。

- **输出参数**:
  - **LS-SQLCODE**: S9(9) COMP型，SQL操作结果代码。

- **备注**: 验证保单ID是否存在于数据库中。

### 子程序 INSPMINS - 支付记录插入子程序

- **输入参数**:
  - **PAYMENT-RECORD**: 复合结构，包含支付记录信息。
  - **LS-ACCOUNTING-PERIOD**: X型，6位，会计期间。

- **输出参数**:
  - **LS-SQLCODE**: S9(9) COMP型，SQL操作结果代码。

- **备注**: 将支付记录插入到保费支付表中。

### 子程序 INSPMLOG - 日志记录子程序

- **输入参数**:
  - **LOG-PARAMS**: 复合结构，包含日志级别、模块名和消息。

- **输出参数**:
  - **LOG-RETURN-CODE**: X型，1位，操作结果代码。

- **备注**: 记录程序执行日志。 
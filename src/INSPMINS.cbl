      ******************************************************************
      * 支付记录插入子程序
      * 功能：将支付记录插入到数据库中
      ******************************************************************
       IDENTIFICATION DIVISION.
       PROGRAM-ID. INSPMINS.
       AUTHOR. DEMO.
       DATE-WRITTEN. 2025-07-15.
      
       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       
       DATA DIVISION.
       WORKING-STORAGE SECTION.
      * SQL通信区域
       01  SQLCA.
           05  SQLCAID                PIC X(8).
           05  SQLCABC                PIC S9(9) COMP.
           05  SQLCODE                PIC S9(9) COMP.
           05  SQLERRM.
               49  SQLERRML           PIC S9(4) COMP.
               49  SQLERRMC           PIC X(70).
           05  SQLERRP                PIC X(8).
           05  SQLERRD OCCURS 6 TIMES PIC S9(9) COMP.
           05  SQLWARN.
               10 SQLWARN0            PIC X.
               10 SQLWARN1            PIC X.
               10 SQLWARN2            PIC X.
               10 SQLWARN3            PIC X.
               10 SQLWARN4            PIC X.
               10 SQLWARN5            PIC X.
               10 SQLWARN6            PIC X.
               10 SQLWARN7            PIC X.
           05  SQLEXT                 PIC X(8).
           
      * 工作变量
       01  WS-CURRENT-DATE-DATA.
           05 WS-CURRENT-DATE.
              10 WS-CURRENT-YEAR      PIC 9(4).
              10 WS-CURRENT-MONTH     PIC 9(2).
              10 WS-CURRENT-DAY       PIC 9(2).
           05 WS-CURRENT-TIME.
              10 WS-CURRENT-HOUR      PIC 9(2).
              10 WS-CURRENT-MINUTE    PIC 9(2).
              10 WS-CURRENT-SECOND    PIC 9(2).
              10 WS-CURRENT-MSEC      PIC 9(2).
           05 WS-DIFF-FROM-GMT        PIC S9(4).
           
       01  WS-TIMESTAMP               PIC X(14).
       
       LINKAGE SECTION.
      * 支付记录结构
       01 PAYMENT-RECORD.
          05 PR-POLICY-ID            PIC X(10).
          05 PR-PAYMENT-DATE         PIC X(8).
          05 PR-PAYMENT-METHOD       PIC X(2).
          05 PR-AMOUNT               PIC 9(8)V99.
          05 PR-PAYMENT-ID           PIC X(12).
          05 PR-REFERENCE-NO         PIC X(16).
          
       01  LS-ACCOUNTING-PERIOD       PIC X(6).
       01  LS-SQLCODE                 PIC S9(9) COMP.
       
       PROCEDURE DIVISION USING PAYMENT-RECORD, 
                                LS-ACCOUNTING-PERIOD, 
                                LS-SQLCODE.
       0000-MAIN-PROCESS.
      * 获取当前时间戳
           MOVE FUNCTION CURRENT-DATE TO WS-CURRENT-DATE-DATA
           STRING WS-CURRENT-YEAR
                  WS-CURRENT-MONTH
                  WS-CURRENT-DAY
                  WS-CURRENT-HOUR
                  WS-CURRENT-MINUTE
                  WS-CURRENT-SECOND
             DELIMITED BY SIZE
             INTO WS-TIMESTAMP
           END-STRING
           
      * 这里在实际情况下会执行SQL插入操作
      * 为了模拟DB2操作，我们使用简单的逻辑
      * 在实际项目中，这里会有EXEC SQL语句
           
      * 模拟一些错误情况
           IF PR-PAYMENT-ID = 'PAY000000011' OR
              PR-PAYMENT-ID = 'PAY000000013' OR
              PR-PAYMENT-ID = 'PAY000000015'
               MOVE 0 TO SQLCODE
           ELSE
      * 模拟已存在的情况
               MOVE -803 TO SQLCODE
           END-IF
           
      * 返回SQLCODE
           MOVE SQLCODE TO LS-SQLCODE
           
           GOBACK.
       END PROGRAM INSPMINS. 




























































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































